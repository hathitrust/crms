<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <script type="text/javascript" src="/c/crms/common.js"></script>
    <script type="text/Javascript">
<!--
function toggleVisibility(id)
{
  var me = document.getElementById(id);
  if (me == null)
  {
    //alert("Can't get " + id);
  }
  else
  {
    if (me.style.display!="none") {me.style.display="none";}
    else {me.style.display="";}
  }
}

function selMenuItem(id, value)
{
  var me = document.getElementById(id);
  if (me == null)
  {
    //alert("Can't get " + id);
  }
  else
  {
    for (var i = 0; i < me.length; i++)
    {
      if (me.options[i].value == value)
      {
        me.selectedIndex = i;
        break;
      }
    }
  }
}
-->
    </script>
    [% IF cgi.param('navRight') %]
      <link rel="stylesheet" type="text/css" href="/c/crms/css/reviewRight.css"/>
    [% ELSE %]
      <link rel="stylesheet" type="text/css" href="/c/crms/css/review.css"/>
    [% END %]
    [% page = cgi.param('p') %]
    [% IF page == 'review' %][% INCLUDE reviewJs.tt %][% END %]
    [% IF page.search('(?i)reviews') || page == 'expert' || page == 'queue'  || page == 'determinationStats' || page == 'holds' || page == 'adminHolds' %]
      <link rel="stylesheet" type="text/css" href="/c/crms/css/datepicker.css"/>
    [% END %]
    [% IF page == 'exportStats' %]
      <script type="text/javascript" src="/c/crms/swfobject.js"></script>
      <script type="text/javascript">
<!--
swfobject.embedSWF("/c/crms/open-flash-chart.swf", "chart0", "400", "300", "9.0.0",
                   "expressInstall.swf", {"data-file":escape("/cgi/c/crms/getExportStats?type=graph&c=2")});
swfobject.embedSWF("/c/crms/open-flash-chart.swf", "chart1", "800", "300", "9.0.0",
                   "expressInstall.swf", {"data-file":escape("/cgi/c/crms/getExportStats?type=graph&c=0&startDate=2009-07")});
swfobject.embedSWF("/c/crms/open-flash-chart.swf", "chart2", "800", "300", "9.0.0",
                   "expressInstall.swf", {"data-file":escape("/cgi/c/crms/getExportStats?type=graph&c=1&startDate=2009-07")});
// -->
      </script>
    [% END %]
    [% IF page == 'determinationStats' %]
      <script type="text/javascript" src="/c/crms/swfobject.js"></script>
      <script type="text/javascript">
<!--
function gup( name )
{
  name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
  var regexS = "[\\?&]"+name+"=([^&#]*)";
  var regex = new RegExp( regexS );
  var results = regex.exec( window.location.href );
  if( results == null )
    return "";
  else
    return results[1];
}
start = gup('startDate');
end = gup('endDate');
monthly = gup('monthly');
str = "/cgi/c/crms/getExportStats?type=graph&c=3&startDate=" + start + "&endDate=" + end + "&monthly=" + monthly;
swfobject.embedSWF("/c/crms/open-flash-chart.swf", "chart0", "800", "300", "9.0.0",
                   "expressInstall.swf", {"data-file":escape(str)});
str = "/cgi/c/crms/getExportStats?type=graph&c=3&startDate=2009-0101&endDate=0&monthly=1&title=Project Determinations Breakdown";
swfobject.embedSWF("/c/crms/open-flash-chart.swf", "chart1", "800", "300", "9.0.0",
                   "expressInstall.swf", {"data-file":escape(str)});
// -->
      </script>
    [% END %]
    [% where = crms.WhereAmI %]
    [% IF where %][% title = title _ ' - ' _ where %][% END %]
    <title>[% title %] - [% crms.PageToEnglish(page) %]</title>
  </head>
  <body>
[% r = crms.GetSystemStatus() %]

[% IF page != 'review' %]
    <div class="pages" id="homePage">
    <div style="height:80px;border-bottom:1px solid black;margin:0px;padding-bottom:6px;">
      <a href="crms">
        <img src="/c/crms/crms.png" width="455" height="80" alt="CRMS Logo" style="float:left;border:0px solid;margin-right:4em;"/>
      </a>
      <div style="text-align:right;">
        <span class="smallishText">Version 1.8
          [% IF crms.GetTrainingMode() %]<br/>Training Mode[% END %]<br/>
        </span>
        <span class="greeting">Hello [% crms.GetUserName() %]</span>
        <a href="crms?p=Logout"> Logout</a><br/>
        [% IF where %]<span class="greeting" style="color:#185EAC;">Current location: $where</span>[% END %]
      </div>
    </div>
    <div style="border-bottom:1 px solid black;">
      [% INCLUDE nav.tt %]
    </div>
    <br/><br/><br/>
[% ELSE %]
    <div id="homePage">
[% END %]
[% # Don't display the notice if this is the review page and situation normal %]
[% IF r.2 && (page != 'review' || r.1 != 'normal') %]
  [% blah = r.2.replace('\s','&nbsp;') %]
  <table style="width:820px;height:80px;border:1px solid #AA0000;background-color:#EEEEFF;position:absolute;top:20px;left:20px;">
  <tr><td>
   [% status = (r.1 == 'normal')? 'normal':((r.1 == 'down')? 'unavailable':'partially available') %]
   <span style="font-size:1.4em;text-align:center;">System status is <b>[% status %]</b>; last modified [% r.0 %]</span><br/><br/>
   <span style="font-size:1.1em;">[% r.2 %]</span>
   [% IF page == 'review' %]&nbsp;&nbsp;&nbsp;<a href="crms">Home</a>[% END %]
  </td></tr>
  </table>
[% END %]
[% IF r.1 != 'normal' %]
  [% page = cgi.param('p') %]
  [% IF page != 'debug' %]
    [% IF r.1 == 'down' %]
      [% IF page == 'queueAdd' %]|| <a href="crms?p=admin">Admin Page</a> ||[% END %]
      [% IF crms.IsUserAdmin() %]|| <a href="crms?p=debug">The Secret Debug Page</a> ||[% END %]
      [% INCLUDE footer.tt %]
      [% STOP %]
    [% END %]
    [% IF r.1 == 'partial' && (page == 'queueAdd' || page == 'review') %]
      [% IF page == 'queueAdd' %]|| <a href="crms?p=admin">Admin page</a> ||[% END %]
      [% INCLUDE footer.tt %]
      [% STOP %]
    [% END %]
  [% END %]
[% END %]
