<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta http-equiv="Content-Script-Type" content="text/javascript"/>
    <meta http-equiv="Content-Style-Type" content="text/css"/>
    <script type="text/javascript" src="/c/crms/common.js"></script>
    <script type="text/javascript" src="/c/crms/menu.js"></script>
    <script type="text/Javascript">
<!--
function toggleVisibility(id)
{
  var me = document.getElementById(id);
  if (me == null)
  {
    //alert("Can't get " + id);
  }
  else
  {
    if (me.style.display!="none") {me.style.display="none";}
    else {me.style.display="";}
  }
}

function selMenuItem(id, value)
{
  var me = document.getElementById(id);
  if (me == null)
  {
    //alert("Can't get " + id);
  }
  else
  {
    for (var i = 0; i < me.length; i++)
    {
      if (me.options[i].value == value)
      {
        me.selectedIndex = i;
        break;
      }
    }
  }
}
-->
    </script>
    <link rel="stylesheet" type="text/css" href="/c/crms/css/review.css"/>
    [% page = cgi.param('p') %]
    [% IF page == 'review' %][% INCLUDE reviewJs.tt %][% END %]
    [% IF page.search('(?i)reviews') || page == 'expert' || page == 'queue'  || page == 'determinationStats' || page == 'holds' || page == 'adminHolds' %]
      <link rel="stylesheet" type="text/css" href="/c/crms/css/datepicker.css"/>
    [% END %]
    [% IF page == 'exportStats' %]
      <script type="text/javascript" src="/c/crms/swfobject.js"></script>
      <script type="text/javascript">
<!--
swfobject.embedSWF("/c/crms/open-flash-chart.swf", "chart0", "400", "300", "9.0.0",
                   "expressInstall.swf", {"data-file":escape("/cgi/c/crms/getExportStats?type=graph&c=2")});
swfobject.embedSWF("/c/crms/open-flash-chart.swf", "chart1", "800", "300", "9.0.0",
                   "expressInstall.swf", {"data-file":escape("/cgi/c/crms/getExportStats?type=graph&c=0&startDate=2009-07")});
swfobject.embedSWF("/c/crms/open-flash-chart.swf", "chart2", "800", "300", "9.0.0",
                   "expressInstall.swf", {"data-file":escape("/cgi/c/crms/getExportStats?type=graph&c=1&startDate=2009-07")});
// -->
      </script>
    [% END %]
    [% IF page == 'determinationStats' %]
      <script type="text/javascript" src="/c/crms/swfobject.js"></script>
      <script type="text/javascript">
<!--
function gup( name )
{
  name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
  var regexS = "[\\?&]"+name+"=([^&#]*)";
  var regex = new RegExp( regexS );
  var results = regex.exec( window.location.href );
  if( results == null )
    return "";
  else
    return results[1];
}
start = gup('startDate');
end = gup('endDate');
monthly = gup('monthly');
priority = gup('priority');
str = "/cgi/c/crms/getExportStats?type=graph&c=3&startDate=" + start + "&endDate=" + end + "&monthly=" + monthly + "&priority=" + priority;
swfobject.embedSWF("/c/crms/open-flash-chart.swf", "chart0", "800", "300", "9.0.0",
                   "expressInstall.swf", {"data-file":escape(str)});
str = "/cgi/c/crms/getExportStats?type=graph&c=3&startDate=2009-0101&endDate=0&monthly=1&title=Project Determinations Breakdown";
swfobject.embedSWF("/c/crms/open-flash-chart.swf", "chart1", "800", "300", "9.0.0",
                   "expressInstall.swf", {"data-file":escape(str)});
// -->
      </script>
    [% END %]
    [% where = crms.WhereAmI %]
    [% IF where %][% title = title _ ' - ' _ where %][% END %]
    <title>[% title %] - [% crms.PageToEnglish(page) %]</title>
  </head>
  <body>
[% r = crms.GetSystemStatus() %]

[% IF page != 'review' %]
    <div class="pages" id="homePage">
    <div style="height:82px;border-bottom:1px solid black;margin:0px;padding-bottom:6px;">
      <a href="crms">
        <img src="/c/crms/crms.png" width="455" height="80" alt="CRMS Logo" style="float:left;border:0px solid;margin-right:4em;"/>
      </a>
      <div style="float:right;">
        <table class="exportStats">
          <tr>
            <th nowrap="nowrap" style="text-align:right;">
              Hello&nbsp;[% crms.GetUserName().replace(" ","&nbsp;") %]&nbsp;&nbsp;<a href="crms?p=Logout" class="header">logout</a>
            </th>
          </tr>
          <tr>
            <th nowrap="nowrap" style="text-align:right;">
              Contact:&nbsp;<a href="mailto:crms-experts@umich.edu?subject=CRMS+Feedback" class="header">crms-experts@umich.edu</a>
            </th>
          </tr>
          <tr>
           <th style="text-align:right;">CRMS&nbsp;Version&nbsp;2.3</th>
          </tr>
          [% IF where %]
            <tr>
              <th style="text-align:right;">Location:&nbsp;[% where.replace(" ","&nbsp;") %]</th>
            </tr>
          [% END %]
        </table>
      </div>
    </div>
    <div style="border-bottom:1 px solid black;">
      [% INCLUDE nav.tt %]
    </div>
    <br/><br/><br/>
[% ELSE %]
    <div id="homePage">
[% END %]
[% # Don't display the notice if this is the review page and situation normal %]
[% IF r.2 && (page != 'review' || r.1 != 'normal') %]
  <img src="/c/crms/crmsblue.png" alt="CRMS Logo" width="104" height="80" style="position:absolute;top:20px;left:20px;"/>
  <table style="width:860px;height:80px;border:1px solid #185EAC;background-color:#EEEEFF;position:absolute;top:20px;left:124px;">
  <tr><td>
   [% status = (r.1 == 'normal')? 'normal':((r.1 == 'down')? 'unavailable':'partially available') %]
   <span style="font-size:1.3em;text-align:center;color:#DD4444">System status is <b>[% status %]</b>; last modified [% r.0 %]</span><br/>
   <span style="font-size:1.1em;">[% r.2 %]</span>
   [% IF page == 'review' %]&nbsp;&nbsp;&nbsp;<a href="crms">Home</a>[% END %]
  </td></tr>
  </table>
[% END %]
[% IF r.1 != 'normal' %]
  [% page = cgi.param('p') %]
  [% IF page != 'systemStatus' %]
    [% IF r.1 == 'down' %]
      [% INCLUDE footer.tt %]
      [% STOP %]
    [% END %]
    [% IF r.1 == 'partial' && (page == 'queueAdd' || page == 'review') %]
      [% INCLUDE footer.tt %]
      [% STOP %]
    [% END %]
  [% END %]
[% END %]
