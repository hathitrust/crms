<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <script type="text/javascript" src="/c/crms/common.js"></script>
    <script type="text/Javascript">
<!--
function toggleVisibility(id)
{
  var me = document.getElementById(id);
  if (me == null)
  {
    //alert("Can't get " + id);
  }
  else
  {
    if (me.style.display!="none") {me.style.display="none";}
    else {me.style.display="";}
  }
}
-->
    </script>
    [% IF cgi.param('navRight') %]
      <link rel="stylesheet" type="text/css" href="/c/crms/css/reviewRight.css"/>
    [% ELSE %]
      <link rel="stylesheet" type="text/css" href="/c/crms/css/review.css"/>
    [% END %]
    [% page = cgi.param('p') %]
    [% IF page == 'review' %][% INCLUDE reviewJs.tt %][% END %]
    [% IF page.search('(?i)reviews') || page == 'expert' || page == 'queue'  || page == 'determinationStats' %]
      <link rel="stylesheet" type="text/css" href="/c/crms/css/datepicker.css"/>
    [% END %]
    [% IF page == 'exportStats' %]
      <script type="text/javascript" src="/c/crms/swfobject.js"></script>
      <script type="text/javascript">
<!--
swfobject.embedSWF("/c/crms/open-flash-chart.swf", "chart0", "400", "300", "9.0.0",
                   "expressInstall.swf", {"data-file":escape("/cgi/c/crms/getExportStats?type=graph&c=2")});
swfobject.embedSWF("/c/crms/open-flash-chart.swf", "chart1", "800", "300", "9.0.0",
                   "expressInstall.swf", {"data-file":escape("/cgi/c/crms/getExportStats?type=graph&c=0&startDate=2009-07")});
swfobject.embedSWF("/c/crms/open-flash-chart.swf", "chart2", "800", "300", "9.0.0",
                   "expressInstall.swf", {"data-file":escape("/cgi/c/crms/getExportStats?type=graph&c=1&startDate=2009-07")});
swfobject.embedSWF("/c/crms/open-flash-chart.swf", "chart3", "400", "300", "9.0.0",
                   "expressInstall.swf", {"data-file":escape("/cgi/c/crms/getExportStats?type=graph&c=0")});
swfobject.embedSWF("/c/crms/open-flash-chart.swf", "chart4", "400", "300", "9.0.0",
                   "expressInstall.swf", {"data-file":escape("/cgi/c/crms/getExportStats?type=graph&c=1")});
// -->
      </script>
    [% END %]
    [% IF page == 'determinationStats' %]
      <script type="text/javascript" src="/c/crms/swfobject.js"></script>
      <script type="text/javascript">
<!--
function gup( name )
{
  name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
  var regexS = "[\\?&]"+name+"=([^&#]*)";
  var regex = new RegExp( regexS );
  var results = regex.exec( window.location.href );
  if( results == null )
    return "";
  else
    return results[1];
}
start = gup('startDate');
end = gup('endDate');
monthly = gup('monthly');
str = "/cgi/c/crms/getExportStats?type=graph&c=3&startDate=" + start + "&endDate=" + end + "&monthly=" + monthly;
swfobject.embedSWF("/c/crms/open-flash-chart.swf", "chart0", "800", "300", "9.0.0",
                   "expressInstall.swf", {"data-file":escape(str)});
str = "/cgi/c/crms/getExportStats?type=graph&c=3&startDate=2009-0101&endDate=0&monthly=1&title=Project Determinations Breakdown";
swfobject.embedSWF("/c/crms/open-flash-chart.swf", "chart1", "800", "300", "9.0.0",
                   "expressInstall.swf", {"data-file":escape(str)});
// -->
      </script>
    [% END %]
    [% dev = crms.get('dev') %]
    [% fulltitle = title %]
    [% IF dev %]
      [% fulltitle = fulltitle _ ' - ' _ 'Development' %]
      [% IF dev != 1 %]
        [% fulltitle = fulltitle _ ' (' _ dev _ ')' %]
      [% END %]
    [% END %]
    <title>[% fulltitle %] - [% crms.PageToEnglish(page) %]</title>
  </head>
  <body>
[% r = crms.GetSystemStatus() %]

[% IF page != 'review' %]
    <div class="pages" id="homePage">
    <div style="float:left; margin-right:10em;"><img src="/c/crms/crms.png" alt="CRMS Logo"/></div>
    [%# INCLUDE nav.tt %]
    <div id="version">Version 1.4</div>
    <br/><br/>
    <div style="clear:both;">
    [% IF r.2 %]<br/>[% END %]
    <span class="greeting">Hello [% crms.GetUserName() %]</span>
    <a href="crms?p=Logout"> Logout</a>
    </div><br/><br/>
[% ELSE %]
    <div id="homePage">
[% END %]
[% # Don't display the notice if this is the review page and situation normal %]
[% IF r.2 && (page != 'review' || r.1 != 'normal') %]
  [% blah = r.2.replace('\s','&nbsp;') %]
  <table style="padding:6px;width:820px;height:115px;border:1px solid #AA0000;background-color:#EEEEFF;position:absolute;top:20px;left:20px;">
  <tr><td>
   [% status = (r.1 == 'normal')? 'normal':((r.1 == 'down')? 'unavailable':'partially available') %]
   <span style="font-size:1.4em;text-align:center;">System status is <b>[% status %]</b>; last modified [% r.0 %]</span><br/><br/>
   <span style="font-size:1.1em;">[% r.2 %]</span>
   [% IF page == 'review' %]&nbsp;&nbsp;&nbsp;<a href="crms">Home</a>[% END %]
  </td></tr>
  </table>
[% END %]
[% IF r.1 != 'normal' %]
  [% page = cgi.param('p') %]
  [% IF page != 'debug' %]
    [% IF r.1 == 'down' %]
      [% IF page == 'queueAdd' %]|| <a href="crms?p=admin">Admin page</a> ||[% END %]
      [% IF crms.IsUserAdmin() %]|| <a href="crms?p=debug">The Secret Debug Page</a> ||[% END %]
      [% INCLUDE footer.tt %]
      [% STOP %]
    [% END %]
    [% IF r.1 == 'partial' && (page == 'queueAdd' || page == 'review') %]
      [% IF page == 'queueAdd' %]|| <a href="crms?p=admin">Admin page</a> ||[% END %]
      [% INCLUDE footer.tt %]
      [% STOP %]
    [% END %]
  [% END %]
[% END %]
