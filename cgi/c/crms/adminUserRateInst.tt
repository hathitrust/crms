[% inst = cgi.param('inst') %]
[% p    = cgi.param('p')    %]

[% IF NOT crms.CanUserSeeInstitutionalStats(inst) %]
  [% INCLUDE denied.tt  %]
  [% STOP %]
[% END %]

[% INCLUDE header.tt %]

<h2>[% inst %] Review Stats:</h2>
<a href="/c/crms/pdf/AllReviewStatsHelp.pdf" target="_blank">All&nbsp;Review&nbsp;Stats&nbsp;Help</a><br/>
<br/>
[% nononexpert = (inst != 'UM-ERAU') %]
[% IF crms.GetTotalHistoricalReviewCount() %]
  [% crms.CreateStatsReport(p, 'all', 1, 1, 0, 1, nononexpert) %]
  <br/><br/>
  [% users = crms.GetUsersWithAffiliation(inst, 1) %]
  [% users.unshift('all' _ '__' _ inst) %]
  [% users.unshift('all') %]
  [% onclicks = '' %]
  [% FOREACH id IN users %]
    [% IF id.match('rereport') %][% NEXT %][% END %]
    [% IF id != 'all' && id.substr(0,5) != 'all__' && 0 == crms.CountAllReviewsForUser(id) %][% NEXT %][% END %]
    [% years = crms.GetStatsYears(id) %]
    [% year = years.shift() %]
    [% FOREACH year IN years %]
      [% divid = id.replace('@','_') _ '_' _ year %]
      [% onclicks = onclicks _ "toggleVisibility(\"$divid\");" %]
    [% END %]
  [% END %]
  [% IF NOT crms.IsTrainingArea() %]
    <a style="display:block;margin-bottom:-18px;padding:4px;width:120px;color:#FFFFFF;background-color:#000000;cursor:pointer;text-align:center;"
       onclick='[% onclicks %]'>Toggle All</a><br/><br/>
  [% END %]
  [% FOREACH id IN users %]
    [% IF id.match('rereport') %][% NEXT %][% END %]
    [% IF id != 'all' && id.substr(0,5) != 'all__' && 0 == crms.CountAllReviewsForUser(id) %][% NEXT %][% END %]
    [% years = crms.GetStatsYears(id) %]
    [% year = years.shift() %]
    [% crms.CreateStatsReport(p, id, 0, 1, year, 1, nononexpert) %]
    <br/><br/>
    [% FOREACH year IN years %]
      [% divid = id.replace('@','_') _ '_' _ year %]
      <a style="display:block;margin-bottom:-18px;padding:4px;width:120px;color:#FFFFFF;background-color:#000000;cursor:pointer;text-align:center;"
         onclick='toggleVisibility("[% divid %]");'>Show [% year %]</a><br/>
      <div id="[% divid %]" style="display:none;position:relative;padding-top:12px;padding-left:40px;border-left:solid 1px #000000;">
      [% crms.CreateStatsReport(p, id, 0, 1, year, 1) %]
      <br/>
      </div>
      <br/><br/>
    [% END %]
  [% END %]
  <span class="smallishText">*Does not include Reviews Awaiting Verdict or pre-CRMS/Legacy reviews.</span>
[% ELSE %]
  There are no historical reviews at this time.
[% END %]
[% INCLUDE footer.tt %]
